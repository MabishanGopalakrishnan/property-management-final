// prisma/schema.prisma

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  LANDLORD
  TENANT
  ADMIN
}

enum LeaseStatus {
  ACTIVE
  TERMINATED
  EXPIRED
}

enum MaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum MaintenancePriority {
  LOW
  MEDIUM
  HIGH
}

model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
  role     Role   @default(TENANT)

  tenant     Tenant?
  properties Property[] @relation("LandlordProperties")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tenant {
  id    Int     @id @default(autoincrement())
  phone String?

  userId Int  @unique
  user   User @relation(fields: [userId], references: [id])

  leases Lease[]
}

model Property {
  id          Int     @id @default(autoincrement())
  title       String
  address     String
  city        String
  province    String
  postalCode  String
  description String?

  landlordId Int
  landlord   User @relation("LandlordProperties", fields: [landlordId], references: [id])

  units Unit[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Unit {
  id         Int    @id @default(autoincrement())
  unitNumber String

  bedrooms   Int   @default(0)
  bathrooms  Int   @default(0)
  rentAmount Float @default(0)

  propertyId Int
  property   Property @relation(fields: [propertyId], references: [id])

  leases Lease[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Lease {
  id        Int         @id @default(autoincrement())
  startDate DateTime
  endDate   DateTime
  rent      Int?
  status    LeaseStatus @default(ACTIVE)

  tenant   Tenant @relation(fields: [tenantId], references: [id])
  tenantId Int

  unit   Unit @relation(fields: [unitId], references: [id])
  unitId Int

  // Payments tied to this lease
  payments Payment[]

  // Maintenance requests tied to this lease
  maintenanceRequests MaintenanceRequest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  id                    Int           @id @default(autoincrement())
  amount                Float
  dueDate               DateTime
  status                PaymentStatus @default(PENDING)
  paidAt                DateTime?
  stripePaymentIntentId String?

  leaseId Int
  lease   Lease @relation(fields: [leaseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MaintenanceRequest {
  id          Int                 @id @default(autoincrement())
  title       String
  description String?
  status      MaintenanceStatus   @default(PENDING)
  priority    MaintenancePriority @default(MEDIUM)

  leaseId Int
  lease   Lease @relation(fields: [leaseId], references: [id])

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
}
