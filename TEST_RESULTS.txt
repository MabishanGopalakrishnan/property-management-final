============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-7.4.3, pluggy-1.6.0 -- /usr/local/bin/python3.11
cachedir: .pytest_cache
rootdir: /app
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, cov-4.1.0, asyncio-0.21.1
asyncio: mode=Mode.STRICT
collecting ... collected 54 items

tests/test_auth.py::TestUserRegistration::test_register_landlord_success PASSED [  1%]
tests/test_auth.py::TestUserRegistration::test_register_tenant_success PASSED [  3%]
tests/test_auth.py::TestUserRegistration::test_register_duplicate_email PASSED [  5%]
tests/test_auth.py::TestUserRegistration::test_register_invalid_email PASSED [  7%]
tests/test_auth.py::TestUserRegistration::test_register_missing_fields PASSED [  9%]
tests/test_auth.py::TestUserLogin::test_login_success PASSED             [ 11%]
tests/test_auth.py::TestUserLogin::test_login_wrong_password PASSED      [ 12%]
tests/test_auth.py::TestUserLogin::test_login_nonexistent_user PASSED    [ 14%]
tests/test_auth.py::TestUserLogin::test_login_missing_credentials PASSED [ 16%]
tests/test_auth.py::TestAuthenticatedAccess::test_get_current_user_with_token PASSED [ 18%]
tests/test_auth.py::TestAuthenticatedAccess::test_get_current_user_without_token PASSED [ 20%]
tests/test_auth.py::TestAuthenticatedAccess::test_get_current_user_invalid_token PASSED [ 22%]
tests/test_auth.py::TestAuthenticatedAccess::test_role_based_access_landlord PASSED [ 24%]
tests/test_auth.py::TestAuthenticatedAccess::test_role_based_access_tenant PASSED [ 25%]
tests/test_dashboard.py::TestDashboardStatistics::test_get_manager_stats PASSED [ 27%]
tests/test_dashboard.py::TestDashboardStatistics::test_stats_calculation_accuracy PASSED [ 29%]
tests/test_dashboard.py::TestDashboardStatistics::test_occupancy_rate_calculation PASSED [ 31%]
tests/test_dashboard.py::TestRecentActivity::test_get_recent_activity PASSED [ 33%]
tests/test_dashboard.py::TestRecentActivity::test_activity_is_user_specific PASSED [ 35%]
tests/test_dashboard.py::TestRecentActivity::test_activity_contains_required_fields PASSED [ 37%]
tests/test_dashboard.py::TestDashboardAuthorization::test_tenant_cannot_access_manager_stats PASSED [ 38%]
tests/test_dashboard.py::TestDashboardAuthorization::test_unauthenticated_cannot_access_dashboard PASSED [ 40%]
tests/test_leases.py::TestLeaseCreation::test_create_lease_success FAILED [ 42%]
tests/test_leases.py::TestLeaseCreation::test_create_duplicate_active_lease_fails FAILED [ 44%]
tests/test_leases.py::TestLeaseCreation::test_create_lease_invalid_dates FAILED [ 46%]
tests/test_leases.py::TestLeaseRetrieval::test_get_all_leases FAILED     [ 48%]
tests/test_leases.py::TestLeaseRetrieval::test_get_lease_by_id PASSED    [ 50%]
tests/test_leases.py::TestLeaseRetrieval::test_tenant_can_view_their_lease PASSED [ 51%]
tests/test_leases.py::TestLeaseUpdate::test_update_lease_status PASSED   [ 53%]
tests/test_leases.py::TestLeaseUpdate::test_update_lease_rent PASSED     [ 55%]
tests/test_payments.py::TestPaymentCreation::test_get_payments_for_lease FAILED [ 57%]
tests/test_payments.py::TestPaymentCreation::test_tenant_can_view_their_payments FAILED [ 59%]
tests/test_payments.py::TestPaymentStatus::test_payment_status_transitions FAILED [ 61%]
tests/test_payments.py::TestStripeIntegration::test_create_checkout_session FAILED [ 62%]
tests/test_payments.py::TestStripeIntegration::test_payment_verification_endpoint_exists PASSED [ 64%]
tests/test_payments.py::TestPaymentValidation::test_negative_payment_amount_rejected FAILED [ 66%]
tests/test_payments.py::TestPaymentValidation::test_zero_payment_amount_rejected FAILED [ 68%]
tests/test_properties.py::TestPropertyCreation::test_create_property_success PASSED [ 70%]
tests/test_properties.py::TestPropertyCreation::test_create_property_without_auth PASSED [ 72%]
tests/test_properties.py::TestPropertyCreation::test_create_property_missing_fields PASSED [ 74%]
tests/test_properties.py::TestPropertyRetrieval::test_get_all_properties PASSED [ 75%]
tests/test_properties.py::TestPropertyRetrieval::test_get_property_by_id PASSED [ 77%]
tests/test_properties.py::TestPropertyRetrieval::test_get_nonexistent_property PASSED [ 79%]
tests/test_properties.py::TestPropertyUpdate::test_update_property_success PASSED [ 81%]
tests/test_properties.py::TestPropertyUpdate::test_update_property_unauthorized PASSED [ 83%]
tests/test_properties.py::TestPropertyDeletion::test_delete_property_success PASSED [ 85%]
tests/test_properties.py::TestPropertyDeletion::test_delete_nonexistent_property PASSED [ 87%]
tests/test_tenants.py::TestTenantCreation::test_get_all_tenants FAILED   [ 88%]
tests/test_tenants.py::TestTenantCreation::test_get_tenant_with_user_info FAILED [ 90%]
tests/test_tenants.py::TestTenantDeletion::test_delete_tenant_without_lease PASSED [ 92%]
tests/test_tenants.py::TestTenantDeletion::test_delete_tenant_with_active_lease_fails PASSED [ 94%]
tests/test_tenants.py::TestTenantDeletion::test_delete_nonexistent_tenant PASSED [ 96%]
tests/test_tenants.py::TestTenantAuthorization::test_tenant_cannot_delete_other_tenants PASSED [ 98%]
tests/test_tenants.py::TestTenantAuthorization::test_tenant_cannot_list_all_tenants FAILED [100%]

=============================== warnings summary ===============================
app/database.py:22
  /app/app/database.py:22: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

../usr/local/lib/python3.11/site-packages/passlib/utils/__init__.py:854
  /usr/local/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.11.14-final-0 ----------
Name                           Stmts   Miss  Cover   Missing
------------------------------------------------------------
app/__init__.py                    0      0   100%
app/auth.py                       60      7    88%   47, 62, 87, 109, 120-125
app/database.py                   15      4    73%   31-35
app/models.py                    112      0   100%
app/routers/__init__.py            0      0   100%
app/routers/auth.py               90     41    54%   110, 120-212
app/routers/dashboard.py          90     46    49%   24-62, 81-114, 205-260, 284-286, 301-310, 324-333
app/routers/leases.py            102     64    37%   25-49, 60-133, 149, 168, 177, 200-224, 235-252, 262-266
app/routers/maintenance.py        83     60    28%   26-64, 75-97, 107-122, 133-154, 165-196, 206-217
app/routers/payments.py          127     97    24%   29-55, 66-88, 98-106, 117-132, 142-156, 166-223, 237-266, 278-310, 323-334
app/routers/properties.py         55      7    87%   26-29, 74, 93, 100, 132
app/routers/tenant_portal.py      27     11    59%   24, 39-51, 60-71
app/routers/tenants.py            36     10    72%   23-26, 36-46, 56-64
app/routers/units.py              93     70    25%   19-25, 35-58, 69-89, 109-117, 138-161, 181-200, 211-219, 231-263
app/routers/webhooks.py           43     31    28%   25-71
app/schemas.py                   181      0   100%
------------------------------------------------------------
TOTAL                           1114    448    60%
Coverage HTML written to dir htmlcov

=========================== short test summary info ============================
FAILED tests/test_leases.py::TestLeaseCreation::test_create_lease_success - a...
FAILED tests/test_leases.py::TestLeaseCreation::test_create_duplicate_active_lease_fails
FAILED tests/test_leases.py::TestLeaseCreation::test_create_lease_invalid_dates
FAILED tests/test_leases.py::TestLeaseRetrieval::test_get_all_leases - assert...
FAILED tests/test_payments.py::TestPaymentCreation::test_get_payments_for_lease
FAILED tests/test_payments.py::TestPaymentCreation::test_tenant_can_view_their_payments
FAILED tests/test_payments.py::TestPaymentStatus::test_payment_status_transitions
FAILED tests/test_payments.py::TestStripeIntegration::test_create_checkout_session
FAILED tests/test_payments.py::TestPaymentValidation::test_negative_payment_amount_rejected
FAILED tests/test_payments.py::TestPaymentValidation::test_zero_payment_amount_rejected
FAILED tests/test_tenants.py::TestTenantCreation::test_get_all_tenants - asse...
FAILED tests/test_tenants.py::TestTenantCreation::test_get_tenant_with_user_info
FAILED tests/test_tenants.py::TestTenantAuthorization::test_tenant_cannot_list_all_tenants
================== 13 failed, 41 passed, 2 warnings in 23.76s ==================
